\chapter{Realisierung} \label{ch:realisierung}

In diesem Kapitel wird die Realisierung der oben beschriebenen Erweiterungen erläutert.
Im ersten Teil wird der aktuelle technische Stand erläutert, anschließend wird im zweiten Teil die Realisierung selbst beschrieben. 

\section{Aktueller technischer Stand}

In diesem Abschnitt soll der aktuelle technische Stand aufgezeigt werden.
Dies dient einerseits dem besseren Verständnis des zweiten Abschnitts dieses Kapitels, andererseits soll somit verdeutlicht werden von welcher Basis ausgegangen wurde und welche Funktionalitäten neu implementiert werden mussten.

Die für diesen Abschnitt benötigten Informationen stammen aus \autocite{cismet-cids} und \autocite{cismet-readme}.

\subsection{Cids-Umgebung}
In der bisherigen Arbeit wurde \ac{WuNDa} als einheitliches System betrachtet, aus technischer Sicht trifft dies jedoch nicht zu.
Tatsächlich ist \ac{WuNDa} ein System, das sich aus mehreren Bestandteilen zusammensetzt und auf der Cids"=Umgebung basiert.
Die Cids"=Umgebung bietet an verschiedenen Stellen Erweiterungsmöglichkeiten, die es erlauben ein auf den jeweiligen Anwendungsfall zugeschnittenes und optimiertes Gesamtsystem zu erstellen, wie dies auch der Fall bei \ac{WuNDa} ist.
Die Hauptbestandteile dieser Umgebung sind der Navigator, der Kernel und verschiedene Entwicklungswerkzeuge.
Eine Übersicht der Cids"=Umgebung kann der Abbildung \ref{fig:cids-komponenten} entnommen werden.
Diese Hauptbestandteile sind in weitere Unterkomponenten eingeteilt. Die in der Abbildung \ref{fig:cids-komponenten} nicht ausgegrauten Komponenten sind für diese Arbeit relevant und werden im Folgenden detaillierter erläutert.
Zunächst wird allerdings der Hauptzweck und der Aufbau des Cids-Umfeldes beschrieben.

\begin{figure}[htb]
	\centering
	\incgraph{width=\textwidth}{./img/cids_components_modified.png}
	\caption{Cids Komponenten}
	\label{fig:cids-komponenten}
\end{figure}

Der Hauptzweck dieses Entwicklungsumfeldes ist das Erstellen von Informationssystemen, insbesondere Geoinformationssystemen (\acs{GIS}).
Dabei stehen häufig benötigte Funktionalitäten wie etwa eine Benutzerverwaltung, ein Berechtigungssystem sowie das Anzeigen, Bearbeiten und Suchen von Informationen bereits zur Verfügung.
Weiterhin wird eine interaktive zweidimensionale Kartenkomponente (Cismap) zur Ansicht von geographischen Daten bereitgestellt.

Durch das Cids"=Umfeld kann ein verteiltes System erstellt werden, dessen Architektur auf dem Client-Server-Prinzip basiert, wobei es aus mehreren Clients, Server, sowie Datenbanken bestehen kann.
Diese Bestandteile können in verschiedenen Ausprägungen nebeneinander existieren.
In Wuppertal steht so z.\,B. neben \ac{WuNDa} auch die VerDIS-Fachanwendung zur Verfügung, welche der Berechnung und Verwaltung von Abwassergebühren dient.
Dabei kann VerDIS auf Informationen aus \ac{WuNDa} zurückgreifen.
Um die Logik der Systeme getrennt zu lassen und um eine Skalierbarkeit zu gewährleisten, besitzt jedes System einen eigenen Domain Server und eine eigene Integration Base.
Bei einem Domain Server handelt sich um eine Schnittstelle zur Integration Base, der die Aufgabe hat aus den Daten konkrete Java"=Klassen und Objekte zu erstellen. Weiterhin ist der Domain Server auch für die Erstellung des Katalogs zuständig.
Broker dienen den Clients als Proxy zu den einzelnen Domain Servern und abstrahieren somit die Komplexität des verteilten Systems, indem sie die Anfragen der Clients an die entsprechenden Domain Server weiterleiten.
Der Registry Server gewährleistet das Zusammenspiel der einzelnen Server, indem er z.\,B. die Namensauflösung für die restlichen Server bereitstellt.

In den folgenden Abschnitten des Kapitels werden die für diese Arbeit relevantesten Bestandteile der Cids-Umgebung näher beleuchtet.

\subsection{Navigator}
Beim Navigator handelt es sich um eine erweiterbare graphische Benutzeroberfläche der Cids"=Umgebung.
Der Client von \ac{WuNDa} ist eine Erweiterung des Navigators.
Die für diese Arbeit wichtigsten Unterkomponenten sind der Katalog, die Suche sowie die Renderer und die Editoren.

\subsubsection{Katalog} \label{subsubsec:katalog}
Beim Katalog handelt es sich um einen Baum über den die verschiedenen Themen bis hin zu einzelnen Objekten angezeigt werden können.
Der Aufbau des Katalogs wird im Folgenden mittels eines Beispiels verdeutlicht.

\begin{figure}[htb]
	\centering
	\incgraph{width=0.618\textwidth}{./rimg/gui-alwis-katalog.png}
	\caption{WuNDa-Katlog eines ÖbVIs}
	\label{fig:katlog-oebvi}
\end{figure}

Der \autoref{fig:katlog-oebvi} kann der Katalog entnommen werden, wie ein in \ac{WuNDa} angemeldeter \ac{ÖbVI} ihn sieht.
Bei dem Knoten \enquote{\acs{ALWIS}}\footnote{
\acs{ALWIS} (\acl{ALWIS}) fasst mehrere Teilsysteme von \ac{WuNDa} zusammen. Unter \acs{ALWIS} finden sich die ALKIS-Benutzungskomponenten und alle weiteren Datenbestände die für die Katasterbenutzung relevant sind, so z.\,B. das Vermessungsregister \autocite[vgl.][]{wupp-wunda-oebvi}.}
handelt es sich um einen sogenannten organisatorischen Knoten, diese Knoten besitzen eine feste Anzahl an Unterknoten.
Bei dem Unterknoten \enquote{Buchungsblätter} handelt es sich um einen dynamischen Knoten, ein solcher Knoten besitzt eine SQL-Query, mit der seine Unterknoten ermittelt und erstellt werden können.
Diese dynamischen Kinder können ebenfalls SQL-Queries besitzen, so dass diese wiederum eigene Unterknoten mit eigenen Queries besitzen können.
Die Blätter des Baumes sind Objektknoten, also konkrete Objekte.
Mit Hilfe von den Queries auf den verschiedenen Ebenen kann der Baum dynamisch gefüllt werden und zeigt jeweils den aktuellen Stand der Daten an.
Ändern sich die unterliegenden Daten, so kann der Baum aktualisiert werden und der Benutzer sieht wieder der aktuelle Stand der Daten.

\subsubsection{Suche}
Bei der Suche handelt es sich um eine Schnittstelle zum Kernel, die das Suchen von Objekten ermöglicht.
Diese Suche kann an verschiedene Anwendungsfälle angepasst werden.
Eine Suche kann aus der Eingabe von Suchkriterien in einer Maske bestehen, woraufhin nach passenden Objekten gesucht wird.
Weiterhin kann die Karte (cismap) auch als Suckriterium miteinbezogen werden, indem der Benutzer dort einen Bereich festlegt, woraufhin nach sämtlichen Objekten, einer bestimmten Cids"=Klasse, gesucht wird, die sich in diesem Bereich befinden.

\subsubsection{Renderer und Editor}
Die Renderer und Editoren wurden bereits in \autoref{sec:gewuenschte-erweiterungen} beschrieben und werden deshalb hier nicht weiter erläutert.

\subsection{ABF}
Der \ac{ABF} ist ein Werkzeug, mit dem verschiedene Daten der Integration Base visualisiert und bearbeitet werden können.
Hierzu gehören z.\,B. Cids"=Klassen (vergleiche \autoref{sec:gewuenschte-erweiterungen}) und ihre Attribute, sowie Benutzer und Benutzergruppen.

Der \ac{ABF} bietet ebenfalls Funktionalitäten, die die Darstellung des Kataloges für den Endnutzer beeinflussen.
Von besonderer Bedeutung ist dabei eine Vorschau des Katalogs, die es erlaubt sämtliche wesentlichen Informationen der Knoten zu bearbeiten.
Dazu gehören neben den SQL-Queries für das Erzeugen der dynamischen Kinder auch die Rechte der verschiedenen Nutzergruppen.
Da die Berechtigungen eine wichtige Rolle in dieser Arbeit spielen, werden sie im Folgenden näher beleuchtet. 

\subsubsection{Berechtigungen}
In diesem Unterabschnitt wird kurz auf das Rechtesystem der Cids-Umgebung eingegangen. In dieser Arbeit werden zwei Arten von Rechte benötigt. Die Lese- und Schreibrechte auf Cids"=Klassen, Attribute und Knoten des Katalogs sowie die Aktionsrechte.

\paragraph{Rechte auf Objekte}
Für jede Cids"=Klasse, Attribut oder Knoten kann eine Rechte-Policy ausgewählt werden.
Die verschiedenen Policies und deren Bedeutung kann der \autoref{tab-policy} entnommen werden.

\begin{minipage}{\linewidth}
\centering
\captionof{table}{Rechte-Policies} \label{tab-policy}
\begin{tabular}{|l|c|c|}
\hline
\rowcolor{gray} 
 & \head{Leserecht} & \head{Schreibrecht} \tabularnewline
\hline 
Secure & - & - \\ 
\hline 
Standard & \checkmark & - \\ 
\hline 
Wiki & \checkmark & \checkmark \\ 
\hline 
\end{tabular} 
\end{minipage}

Um zu vermeiden, dass für jedes Objekt eine Policy explizit gesetzt werden muss, wurde die Fallback Strategie eingeführt.
Diese Strategie ermöglicht es z.\,B. eine Policy als Standard-Server-Policy festzulegen, woraufhin jede Cids"=Klasse auf diese zurückgreift.
Wird für eine Klasse eine andere Policy benötigt, so kann diese explizit gesetzt werden.

Für jedes Objekt können diese Rechte für verschiedene Benutzergruppen erweitert oder eingeschränkt werden.
Für eine Cids"=Klasse mit der Policy "`Secure"' kann z.\,B. festgelegt werden, dass die Administratoren Lese- und Schreibrechte besitzen.
Im Gegensatz hierzu kann einer Benutzergruppe für eine Cids"=Klasse mit der Policy "`Standard"', die Leserechte entzogen werden. \autocite[vgl.][]{cismet-workshop}

\paragraph{Aktionsrecht}
Eine weitere Möglichkeit um Berechtigungen in der Cids"=Umgebung zu setzen sind die Aktionsrechte, auch Action Tags genannt.
Im Gegensatz zu den Rechten auf Objekten werden in diesem Fall Rechte auf Aktionen gesetzt.
Ein Aktionsrecht besitzt jeweils einen eindeutigen Namen sowie eine Liste mit Besitzern.
In dieser Liste können sich ganze Benutzergruppen oder einzelne Benutzer aus einer Benutzergruppe befinden.

Ein Aktionsrecht kann benutzt werden um, im laufenden Programm, zu überprüfen, ob der aktuell angemeldete Benutzer das Recht hat eine bestimmte Aktion durchzuführen.
Für jede Aktion muss es demnach je ein Aktionsrecht geben.
Der Benutzer hat das Recht die Aktion durchzuführen, falls er ein Besitzer des dazugehörigen Aktionsrechtes ist.
Zu solchen Aktionen gehört zum Beispiel die Anzeige bestimmter Suchen oder das Aktivieren/Deaktivieren von Benutzungselementen in einem Renderer.

%\begin{itemize}
%	\item Vor der Realisierung wurde der technische IST-Zustand ermittelt.
%	\item Dabei wurde festgestellt, dass folgendes bereits vorhanden ist:
%	\begin{itemize}
%		\item Cids- System (Renderer/Editoren, DB-Modell, Rechte...)
%		\item GUI: Buchungen erstellen
%		\item ...
%	\end{itemize}
%	\item Auf dieser Basis wurde aufgebaut um die Realisierung durchzuführen.
%\end{itemize}


\section{Technische Realisierung}
Dieser Abschnitt beschreibt die Realisierung der in \autoref{ch:spezi} beschriebenen gewünschten Erweiterungen in \ac{WuNDa}.

\subsection{Datenmodell}
Um die in \autoref{ch:spezi} beschriebenen Anforderungen zu realisieren, muss in einem ersten Schritt das Datenmodell der \ac{WuNDa} Integration Base angepasst werden.
Dies wird zum einen benötigt da die, durch die neuen Erweiterungen, anfallenden Daten abgespeichert werden müssen.
Zum anderen müssen aus den Daten die im Client benötigt werden CidsBeans (siehe auch \autoref{sec:gewuenschte-erweiterungen}) erstellt werden können.
Dies ist notwendig, da die verschiedenen Erweiterungen auf den Funktionalitäten der CidsBeans aufbauen.

\subsubsection{Ausgangslage}
In einem ersten Schritt wurden die bereits vorhandenen, benötigten Cids"=Klassen betrachtet. Hierbei wurde festgestellt, dass einzig die Cids"=Klasse der Buchungen, die \inline{BILLING}"=Klasse vorhanden ist. Diese Klasse ist in der \myfig{fig:db-billing} abgebildet.
\begin{figure}[htb]
	\centering
	\incgraph{scale=0.618}{./rimg/db_model_billing.png}
	\caption{Ausgangslage des Datenbankmodells}
	\label{fig:db-billing}
\end{figure}

\subsubsection{Entstehung des Datenmodells}
Wie bereits in \autoref{ch:spezi} beschrieben, wurde die Spezifikation schrittweise erarbeitet.
Dieser Prozess ist am deutlichsten am Datenbankmodell zu betrachten, welches mit den Anforderungen gewachsen ist.
Da die einzelnen Schritte für das Verständnis der Arbeit nicht relevant sind, werden diese nicht im Detail erläutert.
Um das Anwachsen des Datenmodells trotzdem zu verdeutlichen, wird an dieser Stelle auf zwei Versionen des Datenbankmodells verwiesen deren Abbildungen sich unter \ref{fig:db-two} und \ref{fig:db-three} befinden.

\subsubsection{Benötigte Änderungen}
Nach dem Analysieren der Ausgangslage wurde in einem weiteren Schritt die \inline{BILLING}"=Klasse um die benötigten Felder erweitert.
Bis zu dem Zeitpunkt war die Gebühr einer Buchung in dem einzelnen Feld "`gebuehr"' gespeichert.
Durch das Einführen der MwSt. reicht dies allerdings nicht mehr aus, um die benötigten Funktionalitäten darzustellen.
Aus diesem Grund wurde das Feld  "`gebuehr"' durch die drei Felder "`netto\_summe"', "`brutto\_summe"' und "`mwst\_satz"' ersetzt.
Weiterhin muss eine Buchung storniert werden können, deshalb wurden die folgenden zusätzlichen Felder eingeführt:

\begin{tabulary}{\textwidth}{|L|L|}
\hline 
\rowcolor{gray} 
 \head{Feld} & \head{Beschreibung} \tabularnewline
\hline 
\mbox{storniert} & Ein Boolean, der angibt ob die Buchung storniert wurde, oder nicht. \\ 
\hline 
\mbox{storniert\_durch \hspace{8pt}} & Der Benutzername, des Benutzers der die Buchung storniert hat. \\ 
\hline
\mbox{stornogrund} &  Ein Verweis auf ein Objekt der Cids"=Klasse Stornogrund. \\ 
\hline
\mbox{storno\_datum} & Das Datum, wann die Buchung storniert wurde. \\ 
\hline
\end{tabulary} 

Des Weiteren muss eine Änderung protokolliert werden können, für diese Funktionalität wurden die folgenden Felder eingeführt:

\begin{tabulary}{\textwidth}{|L|L|}
\hline 
\rowcolor{gray} 
 \head{Feld} & \head{Beschreibung} \tabularnewline
\hline 
\mbox{geaendert\_von} & Der Benutzername mit dem die Buchung geändert wurde. \\ 
\hline 
\mbox{geaendert\_am} & Das Datum, an dem die Buchung geändert wurde. \\
\hline
\mbox{aenderung\_attribut} &  Der Spaltenname von dem Wert der geändert wurde. \\ 
\hline
\mbox{aenderung\_alter\_wert} & Der Wert der vor der Änderung in der Buchung stand. \\ 
\hline
\mbox{aenderung\_neuer\_wert \hspace{8pt}} & Der Wert der nach der Änderung in der Buchung steht. \\ 
\hline
\end{tabulary} 

Außerdem wurde das Feld "`abgerechnet"' hinzugefügt:

\begin{tabulary}{\textwidth}{|L|L|}
\hline 
\rowcolor{gray} 
 \head{Feld} & \head{Beschreibung} \tabularnewline
\hline 
\mbox{abgerechnet \hspace{8pt}} & Ein Boolean, der angibt, ob die Buchung bereits abgerechnet wurde, oder nicht. \\ 
\hline
\end{tabulary} 

Des Weiteren wurden die in \autoref{ch:spezi} aufgelisteten Cids"=Klassen in das Datenmodell übernommen. Ihre Felder wurden dort ebenfalls bereits aufgelistet und erläutert, aus diesem Grund wird dies hier nicht wiederholt.

\subsubsection{Letzter Stand}
Der letzte Stand des Datenbankmodells kann in \autoref{fig:db-final} betrachtet werden.
Im Folgenden sollen einige Besonderheiten des Datenmodells hervorgehoben werden.
Sämtliche benutzten Cids"=Klassen besitzen das Präfix "`BILLING\_"', damit diese sofort dem Buchungsthema zugeordnet werden können.
In sämtlichen Billing"=Klassen heißen die Bezeichnungsfelder "`name"', dadurch  erfüllen sie eine Namenskonvention der Cids"=Umgebung.
Diese bewirkt, dass der Wert dieser Felder automatisch in Java bei der toString()-Methode ausgegeben wird.
Weiterhin wurden die Suffixe \enquote{\_arr} und \enquote{\_n} an verschiedene Feldnamen angehangen, um zu verdeutlichen, dass es sich bei diesen um Spezialfelder handelt.
Beim Zugriff der CidsBean auf diese Felder wird eine Liste von Objekten erhalten, wobei bei normalen Felder ein einzelnes Objekt zurückgegeben wird.

\begin{sidewaysfigure}
	\centering
	\incgraph{width=\textwidth}{./rimg/db_model_final.png}
	\caption{Letzter Stand des Datenbankmodells}
	\label{fig:db-final}
\end{sidewaysfigure}

\subsection{Import von neuen Daten}
Die Änderungen am Datenmodell wurden über den bereits erwähnten \ac{ABF} realisiert.
Mit diesem Werkzeug wurden die benötigten Cids"=Klassen angelegt und die entsprechenden Tabellen konnten in die Integration Base eingespielt werden.

Für die weitere Entwicklung der Funktionalitäten wurden Anfangsdaten benötigt, die vom R102 in Form einer Excel-Datei bereitgestellt wurden.
Diese Datei enthielt die Informationen zu tatsächlichen Kunden und Kunden-Logins, wobei z.\,B. die dazugehörigen Abrechnungsturnusse und Produkte angegeben war.
Diese Datei wurde in mehrere \acs{CSV}-Dateien aufgeteilt, die dann in eine Hilfsdatenbank eingespielt wurden.
Mit Hilfe von JPresso, einem  ETL (Extraction, Transaction \& Loading)-Werkzeug \autocite[vgl.][]{cismet-jpresso}, konnten die Daten aus der Hilfsdatenbank in die eigentliche Datenbank importiert werden.

Ein besonderer Fall beim Importieren war der MwSt.-Satz, da dieser bei den bereits angelegten Buchungen nicht existierte.
Somit konnte dieser beim Importieren des Altbestandes nicht auf einen Wert von \per{0,0} gesetzt werden, da dies fachlich falsch wäre.
Dies liegt daran, dass es Produkte mit einem anderen MwSt.-Satz gibt als \per{0,0}, so haben z.\,B. Orthofotos einen MwSt.-Satz von \per{19,0}.
Würde für jede Buchung \per{0,0} eingesetzt werden, so gäbe es Orthofotos mit \per{0,0} und andere mit \per{19,0}.
Dies würde für Verwirrung beim Endbenutzer sorgen, da es sich um einen inkonsistenten Fall handelt.
Eine andere Lösung wäre das Anpassen der Datenbestände gewesen, also das Umändern der Netto- und Brutto-Summen sowie des MwSt.-Satzes. 
Hiergegen wurde sich entschieden, da es sich um kritische Daten handelt und ein kleiner Fehler finanzielle Auswirkungen für das R102 oder einen Kunden hätte.
Aus diesem Grund wurde beim Importieren der MwSt.-Satz auf \inline{null} gesetzt.
Durch diesen Sonderfall kann der MwSt.-Satz, beim Anzeigen, anders behandelt werden und es entsteht keine Verwirrung beim Benutzer.
Weiterhin kann bei Berechnungen \inline{null} genau wie der Satz \per{0,0} behandelt werden, so dass die Netto-Summe immer gleich der Brutto-Summe ist.
Hierdurch ist gewährleistet, dass am ursprünglichen Preis nichts verändert wird.


\subsection{Anpassung des Downloadprotokoll-Dialoges}
Durch die Änderung der Struktur der Buchungen"=Klasse musste auch die Java"=Klasse des Downloadprotokoll"=Dialoges \inline{BillingPopup} angepasst werden.
Dabei sollte an der eigentlichen Funktionalität von \inline{BillingPopup}, die bereits im \autoref{subsec:beschaffung} beschrieben wurde, nichts geändert werden.
Lediglich die graphische Oberfläche wurde dahingehend verändert, dass die Netto- und Brutto-Summen der anfallenden Gebühren sowie der anfallende MwSt-Satz angezeigt werden.
Der Screenshot \ref{fig:alkis-protocol-new} zeigt den überarbeiteten Downloadprotokoll-Dialog.

\begin{figure}[htb]
	\centering
	\incgraph{width=0.618\textwidth}{./rimg/alkis-download-protocol_neu.png}
	\caption{Downloadprotokoll-Dialog mit MwSt.-Satz}
	\label{fig:alkis-protocol-new}
\end{figure}

\subsection{Zeitliche Filter und Verwendungszweckfilter}
Beim Betrachten der benötigten Filter in der Spezifikation fällt auf, dass ähnliche Filtermöglichkeiten in den verschiedenen Renderer und der Suche benötigt werden. Aus diesem Grund wurde der zeitliche Filter und Verwendungszweckfilter als eigenes \inline{JPanel} angelegt, so dass dieses mehrfach verwendet werden kann.

\subsubsection{Zeitlicher Filter}

Das eigenständige \inline{JPanel} \inline{TimeFilterPanel} gibt dem Benutzer die Möglichkeit einen Tag oder eine Zeitspanne auszuwählen.
Dabei werden ihm Schnellwahlmöglichkeiten für den aktuellen Tag, einen Monat oder ein Quartal angeboten.
Weiterhin kann er mittels der Angabe eines von"=Datums und eines bis"=Datums eine Zeitspanne festlegen.

\begin{wrapfigure}{o}{0.4\textwidth}
  \centering
    \incgraph{width=0.3\textwidth}{./rimg/gui-jxdatepicker.png}
  \caption{Auswahl des Datums} \label{fig:jxdatepicker} 
\end{wrapfigure}

Bei Bedarf kann die aktuelle Einstellung des Panels abgefragt werden, wobei der Rückgabewert zwei \inline{Date}-Variablen sind.
Sind beide Variablen \inline{null} so wurde keine Zeit ausgewählt.
Ist nur das von-Datum belegt so wurde ein einzelner Tag ausgewählt.
Sind beide Variablen belegt so wurde eine Zeitspanne festgelegt.
%\begin{figure}[htb]
%	\centering
%	\incgraph{scale=0.618}{./rimg/gui-jxdatepicker.png}
%	\caption{Datumsauswahl mit einer Schnellauswahl für das Jahr}
%	\label{fig:jxdatepicker}
%\end{figure}

Eine weitere Anforderung an die Datumsauswahl ist, dass das Jahr schnell gewechselt werden kann, wie dies der \autoref{fig:jxdatepicker} zu entnehmen ist.
Die verwendete Komponente \inline{JX\-Date\-Picker} bietet eine solche Schnellauswahl  jedoch nicht an.
Aus diesem Grund musste ein Workaround benutzt werden, welches unter \autocite{so-jxdatepicker} gefunden wurde.
%Um diesen Workaround umzusetzen musste ein sogenanntes \inline{Takeoff\-Hook} implementiert werden. 
%Dies ist eine Java"=Klasse die mittels des Lookup-Mechanismus beim Starten von \ac{WuNDa} gefunden und ausgeführt wird.
%Somit wird beim Starten des Programms das \inline{TakeoffHook} \inline{JXDatePickerHeaderTakeoff} ausgeführt, das die zwei Zeilen aus \autoref{lst:setHead} beinhaltet.\\
%\begin{minipage}{\textwidth}
%\begin{lstlisting}[caption=innerhalb \texttt{JXDatePickerHeaderTakeoff}, label=lst:setHead]
%UIManager.put(CalendarHeaderHandler.uiControllerID, "org.jdesktop.swingx.plaf.basic.SpinningCalendarHeaderHandler");
%UIManager.put(SpinningCalendarHeaderHandler.ARROWS_SURROUND_MONTH, Boolean.TRUE);
%\end{lstlisting}
%\end{minipage}
%
%In der ersten Zeile wird angegeben dass für die \inline{JXDatePicker} eine Kopfzeile verwendet wird, die eine Schnellauswahl des Jahres zulässt.
%In der zweiten Zeile wird die Anordnung des rechten Pfeils geändert, dieser würde sich ansonsten ganz rechts außen befinden.
%Damit die Kopfzeile einer \inline{JXDatePicker}-Instanz \inline{datePicker} entsprechend geändert wird, muss die Zeile aus \autoref{lst:setZoomable} ausgeführt werden.\\
%\begin{minipage}{\textwidth}
%\begin{lstlisting}[caption=Setzen der Kopfzeile, label=lst:setZoomable]
%datePicker.getMonthView().setZoomable(true)
%\end{lstlisting}
%\end{minipage}
%
%Genau diese Zeile enthält den problematischen Teil dieses Workaround, da das Zoomable-Attribut von \inline{JX\-Month\-View}, eine Anzeige von Monaten, über die ein Datum gewählt werden kann, noch nicht richtig implementiert ist und keine Auswirkungen haben dürfte \autocite[vgl.][]{swingx-jxdatepicker}.
%Dennoch wird hierdurch die gewünschte Kopfzeile angezeigt.

\subsubsection{Verwendungszweckfilter}
Der Verwendungszweckfilter ist ebenfalls ein eigenständiges \inline{JPanel} und wurde in der Java"=Klasse \inline{VerwendungszweckPanel} implementiert.
In diesem Panel werden die möglichen Verwendungszwecke untereinander angezeigt, wobei jedes eine Checkbox besitzt, mit der es an oder abgewählt werden kann. Weiterhin ist es nicht möglich sämtliche Verwendungszwecke abzuwählen.
Die Besonderheit dieses Panel besteht darin, dass die Verwendungszwecke nicht hart kodiert sind, sondern aus der \inline{billing.json} Datei geladen werden.
Diese \ac{JSON}-Datei beinhaltet Informationen bezüglich den Buchungen. Sie enthält neben den Verwendungszwecken auch die Gebühren und MwSt.-Sätze zu den einzelnen Produkten. 

\subsection{Suche nach Buchungen} \label{subsec:serversearch}
Da sowohl die Kunden- und Kundengruppenrenderer als auch der Suchdialog zu den Buchungen eine Möglichkeit benötigen um nach Buchungen mit bestimmten Kriterien zu suchen, wurde auf die Such"=Funktionalität der Cids"=Umgebung zurückgegriffen und es wurde eine sogenannte Server Search implementiert.
Um diesen Mechanismus umzusetzen wurde die Java"=Klasse \inline{Cids\-Billing\-Search\-State\-ment} erstellt.
Diese erbt von der bereits bestehenden Klasse \inline{Ab\-stract\-Cids\-Server\-Search} und besitzt somit die Grundfunktionalität zu einer solchen Server Search.
Um diese Server Search in den Renderern oder dem Suchdialog auszuführen müssen lediglich die gewünschten Kriterien einem Objekt der Klasse \inline{Cids\-Billing\-Search\-Statement} übergeben werden und die eigentliche Suche muss gestartet werden.
Daraufhin können die gefundenen Buchungen dort weiterverarbeitet und angezeigt werden.
Zu den Kriterien, die angegeben werden können, gehören u.\,a. die Geschäftsbuchnummer, die Projektbezeichnung und den Kundennamen aber auch der Zeitbereich in denen die Buchungen erstellt werden oder ob stornierte und abgerechnete Buchungen gefunden werden sollen.

\subsection{Kunden}
In diesem Abschnitt werden die graphischen Oberflächen beschrieben, die die Cids"=Klasse Kunde betreffen.
\subsubsection{Kundenrenderer}
Die Funktionalität des Kundenrenderers wurde bereits größtenteils in dem \autoref{subsubsec:kundenrenderer} beschrieben.
Der dort nicht beschriebene Knopf "`Ergebnisse anzeigen"' wurde hinzugefügt, damit die Suche bei Bedarf ausgeführt werden kann.
Dieser wurde während der Entwicklung hinzugefügt, da sich die automatisch ausgeführte Suche bei jeder Änderung der Filter als unpraktikabel herausstellte.
Dies liegt an der Dauer der Suche, die für eine solche Funktionalität zu ausgedehnt ist, obwohl diese in den meisten Fällen nur ein paar Sekunden beträgt.
Bei Betätigen des Knopfes wird ein Objekt der Java"=Klasse \inline{Cids\-Billing\-Search\-Statement} mit den verschiedenen Kriterien aus den Filtern gefüllt und die eigentliche Suche wird ausgeführt.
Die Ergebnisse dieser Suche werden dann in der Tabelle angezeigt und eine entsprechende Zusammenfassung der Suchergebnisse wird über der Tabelle ausgegeben.
Weiterhin können die beiden Berichte \enquote{Rechnungsanlage} und \enquote{Buchungsbeleg} erstellt werden, wobei die im \autoref{subsec:berichte} aufgeführten Bedingungen gelten.
So dürfen externe Benutzer die \enquote{Rechnungsanlage} nicht erstellen und es kann ausgewählt werden, ob kostenfreie Buchungen in den Berichten angezeigt werden sollen oder nicht.
Ein Screenshot des Kundenrenderers kann in \myfig{fig:kundenrenderer} eingesehen werden.

\begin{figure}[htb]
	\centering
	\incgraph{width=\textwidth}{./rimg/gui-kunderenderer-real.png}
	\caption{Kundenrenderer}
	\label{fig:kundenrenderer}
\end{figure}
\subsubsection{Kundeneditor}
Der Kundeneditor ermöglicht es einen neuen Kunden anzulegen oder die Daten eines bereits bestehenden Kunden zu bearbeiten.
Bei den meisten Feldern handelt es sich um gewöhnliche Texteingaben oder Auswahlmöglichkeiten.
Allerdings besteht auch die Möglichkeit Beziehung von einem Kunden"=Objekt zu anderen Objekten zu erstellen.
Dies ist der Fall bei den Feldern für die Produkte und Kundengruppen, bei denen auf die Drag-and-Drop Funktionalität der Cids-Umgebung zurückgegriffen wurden.
Somit können Objekte dieser Cids"=Klassen aus dem Katalog in den Editor gezogen werden und die Beziehung zwischen den jeweiligen Objekten wird automatisch erstellt.


%\begin{figure}[htb]
%	\centering
%	\incgraph{width=\textwidth}{./rimg/gui-kundeneditor-real.png}
%	\caption{Kundeneditor}
%	\label{fig:kundeneditor}
%\end{figure}

\subsection{Kundengruppen}
In diesem Abschnitt werden die graphischen Oberflächen beschrieben, die die Cids"=Klasse Kundengruppe betreffen.
\subsubsection{Kundengruppenrenderer und Kundengruppeneditor}
Wie bereits beschrieben bietet der Kundengruppenrenderer einige Filterkriterien, so dass nicht gewünschte Buchungen nicht in die Ergebnisse miteinbezogen werden.
Im Gegensatz zum Kundenrenderer werden die einzelnen Buchungen nicht angezeigt, sondern diese werden für den jeweiligen Kunden zusammengefasst und diese Zusammenfassung wird in der Tabelle dargestellt.
Zum Erstellen der \enquote{Rechnungsanlage} und des \enquote{Buchungsbeleges} stehen die gleichen Optionen zur Verfügung, wie im Kundenrenderer.
Zusätzlich kann die \enquote{Geschäftsstatistik} als Bericht erstellt werden.
Ein Screenshot des Kundengruppenrenderer kann in der \myfig{fig:gui-kundengruppenrenderer} gefunden werden.
\begin{figure}[htb]
	\centering
	\incgraph{width=1\textwidth}{./rimg/gui-kundengruppenrenderer-real.png}
	\caption{Kundengruppenrenderer}
	\label{fig:gui-kundengruppenrenderer}
\end{figure}

Mit dem Kundengruppeneditor kann eine neue Kundengruppe erstellt oder eine alte bearbeitet werden. Bei den Feldern für den Namen und die Beschreibung handelt es sich um normale Texteingaben, wohingegen die Kunden wieder per Drag-and-Drop hinzugefügt werden können.

%\begin{figure}[htb]
%	\centering
%	\incgraph{width=0.618\textwidth}{./rimg/gui-kundengruppeneditor-real.png}
%	\caption{Kundengruppeneditor}
%	\label{fig:gui-kundengruppeneditor}
%\end{figure}

\subsubsection{E-Mail an Kundengruppe erstellen}

Wird im Katalog das Kontextmenü einer Kundengruppe geöffnet, dann erscheinen die zwei zusätzlichen Auswahlmöglichkeiten "`E-Mail an Ansprechpartner"' und "`E-Mail an Nutzer"'.
Siehe hierzu auch die \myfig{fig:gui-kundengruppe-context}.
\begin{figure}[htb]
	\centering
	\incgraph{width=0.618\textwidth}{./rimg/gui-kundengruppen-context-real.png}
	\caption{Kontextmenu einer Kundengruppe}
	\label{fig:gui-kundengruppe-context}
\end{figure}
Mittels diesen beiden Optionen lässt sich ein Vorlagen-Dialog öffnen, mit dem eine Vorlage ausgewählt werden kann.
Wird dieser Dialog bestätigt so wird eine neue E-Mail im Betriebssystem eingestellten Standard-E-Mail-Programm geöffnet.
Diese E-Mail enthält die Werte aus der Vorlage und kann wie gewohnt bearbeitet werden.
Je nach Auswahl der Option werden unterschiedliche E-Mail-Adressen eingesetzt.
Wurden die Ansprechpartner ausgewählt, so werden nur die Direktkontakte der Kunden innerhalb der Kundengruppe der E-Mail hinzugefügt.
Andernfalls werden die Kontakte sämtlicher Kunden-Logins die sich in dieser Gruppe befinden benutzt.
Um die restlichen E-Mail-Adressen den jeweiligen Empfängern nicht bekannt zu machen, werden diese als BCC der E-Mail hinzugefügt.

Die Vorlagen die in dem Vorlagen-Dialog angezeigt werden, werden aus der Datei \inline{email_templates.json} bezogen. Eine Vorlage besitzt die folgenden vier Felder:
\begin{description}
\item[Name] Der Name der Vorlage. Dieser wird in dem Auswahlfeld des Vorlagen-Dialogs angezeigt.
\item[Betreff] Der Betreff der E-Mail.
\item[To-Adressat] Dieser Empfänger wird ebenfalls der E-Mail hinzugefügt und soll als Kontrolle dienen.
\item[Inhalt] Der eigentliche Inhalt der E-Mail.
\end{description}

%\inline{E\-Mail\-Composer} EMailComposer
Um die E-Mail zu öffnen, wurde die Java"=Klasse \inline{E\-Mail\-Composer} implementiert.
Ein Objekt dieser Klasse nimmt die benötigten Informationen entgegen und erstellt eine URI nach dem mailto Schema \autocite{RFC2368}.
Diese URI kann der Java-Methode \inline{Desktop.getDesktop().mail()} \autocite{java-mailto} übergeben werden, dadurch wird das E-Mail-Programm geöffnet, welches dann die E-Mail nach der ausgewählten Vorlage erstellt.

\subsection{Buchungen}
Für die Buchungen musste ein Renderer, ein Editor und ein Suchdialog erstellt werden.

\subsubsection{Buchungseditor und -renderer}
Beim Buchungseditor und -renderer handelt es sich um die gleiche graphische Oberfläche, wobei beim Buchungseditor eine Buchung verändert werden kann.
Die veränderbaren Werte sind die Geschäftsbuchnummer und die Projektbezeichnung, wobei die letzte Änderung jeweils protokolliert werden muss.
Weiterhin kann im Editor eine Buchung, unter Angabe eines Stornogrundes, storniert werden.
Die genauere Beschreibung dieser Oberflächen findet sich unter \autoref{subsec:buchungen} und kann unter \myfig{fig:buchungseditor} betrachtet werden.

\begin{figure}[htbp]
	\centering
	\incgraph{width=0.618\textwidth}{./rimg/gui-buchungseditor-real.png}
	\caption{Buchungseditor}
	\label{fig:buchungseditor}
\end{figure}

\subsubsection{Suchdialog zu den Buchungen}
\begin{figure}[htbp]
	\centering
	\incgraph{width=0.618\textwidth}{./rimg/gui-suchergebnisse-real.png}
	\caption{Suchergebnisse mit Buchungen und Kontextmenu}
	\label{fig:suchergebnisse}
\end{figure}

Der Suchdialog basiert auf der Beschreibung aus \autoref{subsec:buchungen} und bietet eine Möglichkeit verschiedene Kriterien bezüglich Buchungen anzugeben, woraufhin nach Buchungen mit jenen Kriterien gesucht werden kann.
Die graphische Oberfläche der Suche wurde in der Java"=Klasse \inline{Billing\-Window\-Search} umgesetzt.
Diese Klasse kann über einen Lookup-Mechanismus gefunden werden und wird automatisch als Eintrag des Fenster-Menüs von \ac{WuNDa} angezeigt.
Über diesen Eintrag kann der Suchdialog geöffnet und geschlossen werden.

Die eigentliche Suche wurde über die Server Search, die auf Seite \pageref{subsec:serversearch} beschrieben wurde, umgesetzt.
Wobei die gefundenen Ergebnisse  anschließend in den Suchergebnissen von \ac{WuNDa} angezeigt werden.
Ein Beispiel der Suchergebnisse kann in der Abbildung \ref{fig:suchergebnisse} betrachtet werden, dabei wurde das Kontextmenü für den ersten Eintrag geöffnet.
Über dieses Menü kann der Editor der ausgewählten Buchung geöffnet werden.
Da es sich bei dem Kontextmenü um eine Standardkomponente der Cids-Umgebung handelt, befindet sich hier auch die Option "`Objekt löschen"'.
Diese wurde jedoch so eingestellt, dass ein Löschen nicht möglich ist.
Ein Screenshot des Suchdialog selbst kann in \myfig{fig:gui-suchdialog} gefunden werden.

\begin{figure}[htbp]
	\centering
	\incgraph{width=0.8\textwidth}{./rimg/gui-buchungsuche-real.png}
	\caption{Suchdialog der Buchungen}
	\label{fig:gui-suchdialog}
\end{figure}

\subsection{Berichte}
Die drei Berichte \enquote{Buchungsbeleg}, \enquote{Rechnungsanlage} und \enquote{Geschäftsstatistik} wurden nach den Vorgaben aus \autoref{subsec:berichte} mit dem Werkzeug iReport erstellt, welches daraus sogenannte JasperReports erzeugte.
Mittels JasperReports können aus Java heraus Berichte, also PDF-Dateien, dynamisch generiert werden, indem ihnen Parameter und Listen übergeben werden.
Bei den Parametern handelt es sich um normale Java-Objekte, die im JasperReport weiterverarbeitet und angezeigt werden können.
Beim Erstellen des Berichts wird über die mitgegebenen Listen iteriert und deren Elemente können ebenfalls weiterverarbeitet werden.
So können sie z.\,B. in einer Tabelle dargestellt werden oder aufsummiert werden.

Durch die eher eingeschränkte Funktionalität von iReport konnten die Buchungen nicht als eine Liste übergeben werden.
Somit mussten die Daten in \ac{WuNDa} aufbereitet werden und als Parameter übergeben werden.

\subsection{Buchungen-Knoten im Katalog}
Um die Navigation innerhalb des Buchungsthemas zu gewährleisten wurde der Katalog um einen Buchungen-Knoten erweitert.
Dessen Aufbau ist, aus Sicht eines Administrators, in \myfig{fig:katalog} dargestellt.
Diese Erweiterung wurde mit Hilfe des \ac{ABF} durchgeführt.
Dies war insbesondere deshalb nützlich, da es sich bei den Unterknoten, die sich direkt unter dem Knoten \enquote{Buchungen} befinden, um dynamische Knoten handelt.
Somit konnte im \ac{ABF} direkt überprüft werden, ob die Query richtig angegeben wurde, da dort die automatisch erstellten Unterknoten als Vorschau angezeigt werden.
\begin{figure}[htb]
	\centering
	\incgraph{scale=0.7}{./rimg/gui-katalog.png}
	\caption{Aufbau des Katalogs für die Buchungen}
	\label{fig:katalog}
\end{figure}


Der Unterknoten "`Administration"' enthält wiederum Unterknoten mit Objekten, die zur Verwaltung des Buchungsthemas benötigt werden.
So kann mittels des Kontextmenüs der verschiedenen Unterknoten ausgewählt werden ob neue Objekte erstellt oder alte Objekte bearbeitet werden sollen.
Das gleiche gilt für den Unterknoten "`Kundengruppe"', dieser steht nicht unterhalb der "`Administration"' da dieser vor allem benutzt wird um die Kunden- und Kundengruppenrenderer aufzurufen. Mit ihm können aber auch die Kundengruppen verwaltet werden.
Ein besonderer Fall stellt der Unterknoten "`meine Buchungen"' dar, der für die Administratoren leer ist.
An dieser Stelle können die Kunden ihren eigenen Renderer öffnen.
Dies kann der \autoref{fig:kundenkatalog} entnommen werden, dort ist der Katalog eines Benutzer abgebildet, der für Testzwecke benutzt wird und die gleiche Berechtigungen wie ein \ac{ÖbVI} besitzt. Über den Knoten \enquote{Muster ÖbVI gesetzlich} kann er seinen eigenen Kundenrenderer öffnen, und zwar nur seinen eigenen.
\begin{figure}[htb]
  \centering
    \incgraph{scale=0.7}{./rimg/gui-kundenkatalog.png}
  \caption{Katalog eines Kunden} \label{fig:kundenkatalog} 
\end{figure}
 

\subsection{Anlegen der Berechtigungen}

Die verschiedenen benötigten Berechtigungen wurden mit Hilfe des \ac{ABF}s erstellt.
In einem ersten Schritt wurde eine neue Benutzergruppe angelegt, danach wurden die Rechte der Benutzergruppen auf die Cids"=Klassen festgelegt und anschließend wurden noch Aktionsrechte angelegt. 

\subsubsection{Neue Benutzergruppe}
Im \autoref{subsec:berechtigungen} wurde beschrieben, dass nur die \ac{WuNDa}-Administratoren und verschiedene Beamte auf das Buchungsthema zugreifen dürfen.
Für diese Beamte wurde eine Benutzergruppe "`Billing Intern"' angelegt, die danach die Rechte erhalten hat, so dass die Benutzer die Buchungen verwalten können.

Für die Kunden gibt es keine eigene Benutzergruppe, sondern sie sind nach ihrer Art in verschiedene Benutzergruppen eingeteilt.
Diese Benutzergruppen sind "`Unternehmen"', "`Behörde"', "`ÖbVI - gesetzlich"' und "`ÖbVI - kommunal"'.
Diese haben die Rechte erhalten, so dass sie ihren eigenen Kundenrenderer, wie im \autoref{subsubsec:ansicht_externe_benutzer} beschrieben, betrachten können.

\subsubsection{Rechte der Klassen}
Sämtliche Cids"=Klassen mit dem Präfix "`Billing\_"' haben das Standardverhalten "`Secure"' erhalten. Damit wird sichergestellt, dass niemand auf diese Klassen Zugriff erhält, dem die Rechte nicht explizit zugewiesen wurden.
In einem nächsten Schritt haben die Administratoren und die Benutzer der Benutzergruppe "`Billing Intern"' auf diesen Klassen Lese- und Schreibrechte erhalten.
Anschließend haben die verschiedenen Benutzergruppen der Kunden ihre benötigten Rechte erhalten.
Eine Übersicht zu den vergebenen Rechten kann der \mytab{tab:klassenrechte} entnommen werden.
In dieser Tabelle sind die Administratoren und die Billing Intern Gruppe aus Gründen der Vollständigkeit ebenfalls aufgelistet.

\begin{minipage}{\linewidth}
\centering
\captionof{table}{Vergebene Rechte an die Klassen.} \label{tab:klassenrechte}
\begin{tabulary}{\textwidth}{|l|C|c|}
 \hline
 	 \rowcolor{gray} 
  & \head{Administratoren und Billing Intern} & \head{Kunden} \tabularnewline
 \hline
 Abrechnungsturnus
  & r/w & r \\ 
 \hline 
 Billing & r/w & r/w \\ 
 \hline 
 Branche & r/w & r \\ 
 \hline 
 Client & r/w & r \\ 
 \hline 
 Kunde & r/w & r \\ 
 \hline 
 Kunde\_Kundengruppe\_Array & r/w & - \\ 
 \hline 
 Kunde\_Produkt\_Array & r/w & r \\ 
 \hline 
 Kunden\_Logins & r/w & r \\ 
 \hline 
 Kundengruppe & r/w & - \\ 
 \hline 
 Produkt & r/w & r \\ 
 \hline 
 Stornogrund & r/w & r \\ 
 \hline 
 \end{tabulary}
 \par
 \bigskip
 r = Leserecht, w = Schreibrecht, - = keine Rechte
 \end{minipage}
 
\subsubsection{Rechte des Kataloges}
Damit die angelegten Katalog-Knoten nur von den gewünschten Benutzergruppen ausgewählt und benutzt werden können, mussten für die Knoten ebenfalls Rechte gesetzt werden.
Eine Übersicht zu den vergebenen Rechten kann der \mytab{tab:katalogrechte} entnommen werden.
In dieser Tabelle wird das gesetzte Standardverhalten der Knoten ebenfalls aufgelistet.
Das Standardverhalten "`Secure"' funktioniert auf die gleiche Art und Weise wie dies auch bei den Cids"=Klassen der Fall ist.
Einem Knoten kann zusätzlich eine Cids"=Klasse zugewiesen werden, auf die er sich bezieht.
Daraufhin kann als Standardverhalten festgelegt werden, dass der Knoten die Rechte seiner Klasse übernimmt.
In diesen Fällen wurde in der Tabelle Klammern um die Rechte gesetzt, um zu verdeutlichen dass diese übernommen wurden.

\begin{minipage}{\linewidth}
\centering
\captionof{table}{Vergebene Rechte an die Katalogknoten.} \label{tab:katalogrechte}
\begin{tabulary}{\textwidth}{|l|L|C|c|}
 \hline
 	 \rowcolor{gray} 
  & \head{Standardverhalten} & \head{Administratoren und Billing Intern} & \head{Kunden} \tabularnewline
 \hline 
 Buchungen & Secure & r & r \\ 
 \hline 
 Administration & Secure &r & - \\ 
 \hline 
 Kundengruppe & Verhalten von "`Kundengruppen"' & (r/w) & (-) \\ 
 \hline 
 meine Buchungen & Verhalten von "`Kunde"' & (r/w) & (r) \\ 
 \hline 
 \end{tabulary}
 \par
 \bigskip
 r = Leserecht, w = Schreibrecht, - = keine Rechte, () = übernommene Rechte
 \end{minipage}
 
Hierbei ist zu bemerken, dass die Rechte von den Kunden für die Cids"=Klasse "`Kundengruppe"' nicht auf lesend gesetzt werden darf. Wäre dies der Fall so könnten sämtliche Kunden die Kundenrenderer der anderen Kunden öffnen und somit Einsicht in deren Buchungen erhalten.

\subsubsection{Einschränkungen bezüglich der Rechnungsanlage und der Buchungen-Suche}

Nach dem Setzen der Rechte haben die externen Benutzer noch die Möglichkeit die \enquote{Rechnungsanlage} zu erstellen und die Buchungen-Suche zu öffnen.
Aus diesem Grund werden zusätzliche Einschränkungen benötigt, diese werden mit Hilfe der folgenden zwei Aktionsrechten realisiert:
\begin{itemize}
\item custom.billing.reports
\item custom.billing.search
\end{itemize}
Diesen Aktionsrechten wurden die Benutzergruppen "`Administratoren"' und "`Billing Intern"' als Besitzer hinzugefügt.

Die Einschränkungen bezüglich der \enquote{Rechnungsanlage} kann wie folgt realisiert werden.
Im laufenden Programm wird im Kundenrenderer abgefragt, ob der aktuell angemeldete Benutzer ein Besitzer des Aktionsrechtes "`custom.billing.reports"' ist.
Je nach Resultat dieser Abfrage können somit die benötigten GUI-Elemente an- oder ausgeschaltet werden.

Für die Anzeige der Suche wurde eine Cids-Funktionalität verwendet, die das Interface \inline{Action\-Tag\-Protected} liefert.
Um diese Funktionalität umzusetzen muss die Java"=Klasse \inline{Billing\-Window\-Search} dieses Interface implementieren.
Dadurch muss in \inline{Billing\-Window\-Search} die Methode \inline{check\-Action\-Tag()} realisiert sein, die ein Boolean zurückgibt.
Somit fragt diese Methode ab, ob der aktuell angemeldete Benutzer das Aktionsrecht "`custom.""billing.""search"' besitzt, um dieses Ergebnis daraufhin zurück zu gegeben.
Cids-intern wird diese Methode aufgerufen und die Suche wird entsprechend den Berechtigungen im Such-Menü angezeigt oder nicht. 

\subsubsection{Ansicht des eigenen Kundenrenderers}
Die letzte Einschränkung die umgesetzt werden musste war, dass ein externer Benutzer nur den eigenen Kundenrenderer öffnen kann.

In einem ersten Schritt wurde für jeden Kunden ein eigenes Aktionsrecht angelegt.
Der Namensaufbau eines solchen Aktionsrechtes ist: \inline{custom.\-billing.\-tree.\-<interner_\-Name_\-des_\-Kunden>}, wobei \inline{<interner_Name_des_Kunden>} durch den tatsächlichen internen Namen eines Kunden ersetzt wird.
Die Besitzer dieses Aktionsrechts sind die Benutzer die zu einem Kunden gehören. 
Wobei ein Benutzer für jede Benutzergruppe, in der er sich befindet, eingetragen werden muss.
Um dies zu verdeutlichen wird ein konkretes Beispiel angeführt: der Kunde \ac{ÖbVI} Olivier hat den internen Namen "`olivier"'.
Weiterhin hat er einen Login-Name "`oebvi\_olivier"' der sich in den Benutzergruppen "`ÖbVI - gesetzlich"' und "`ÖbVI - kommunal"' befindet.
Sein Aktionsrecht muss demnach folgenden Aufbau haben, wobei die Unterelemente dessen Besitzer darstellen (Login-Name -- Benutzergruppe):
\begin{itemize}
\item custom.billing.tree.olivier
\begin{itemize}
\item oebvi\_olivier -- "`ÖbVI - gesetzlich"'
\item oebvi\_olivier -- "`ÖbVI - kommunal"'
\end{itemize}
\end{itemize}

In einem nächsten Schritt wurde die SQL-Query des dynamischen Knotens "`meine Buchungen"' angepasst.
Diese Query beinhaltet in der Regel Parameter, die zur Erstellung eines Unterknotens benötigt werden, wie etwa die ID oder den anzuzeigenden Namen.
Zusätzlich zu den üblichen Parameter wurde hier der Parameter "`additionaltree""permissiontag"' hinzugefügt.
Dessen Wert besteht aus dem String "`custom.""billing.""tree."' konkateniert mit dem jeweiligen internen Namen des Kunden.
Wichtig zu erwähnen ist, dass somit der Aktionsrechtsname und der Wert des Parameters für einen Kunden gleich ist. 
Im letzten Schritt musste die Erstellung des Katalogs auf diese Gegebenheit umgestellt werden, so dass hier überprüft wird ob der angemeldete Benutzer ein Besitzer des Aktionsrechtes ist, oder nicht.
Ist dies der Fall, so wird sein Kundenknoten im Katalog angezeigt.

Auf diese Weise ist sichergestellt, dass ein Kunde jeweils nur seinen eigenen Knoten sieht und hierüber nur seinen eigenen Kundenrenderer öffnen kann. 

%\begin{itemize}
%	\item Realisiert wurde
%	\begin{itemize}
%		\item in der DB
%		\item in der GUI
%		\item ...
%	\end{itemize}
%\end{itemize}


%\section{Vollständige Umsetzung der Spezifikation}
%Um die vollständige Umsetzung der, in \autoref{ch:spezi} beschriebenen, Funktionalitäten sicherzustellen, wurden die einzelnen Funktionalitäten in GitHub-Issues beschrieben.
%Bei einem solchen Issue handelt es sich um eine Funktionalität, die, die Internet-Plattform GitHub neben dem Code-Upload anbietet, dabei kann ein Anliegen beschrieben und von mehreren Benutzern kommentiert werden \autocite[vgl.][]{github-issue}.
%Der übliche Vorgang für die Entwicklung einer Funktionalität war üblicherweise, dass in einem ersten Schritt die Beschreibung der Funktionalität dem Issue entnommen wurde, diese Funktionalität wurde dann umgesetzt und als Testversion ausgeliefert.
%Anschließend konnte ein Beamter des Katasteramtes die Funktionalität testen und das entsprechende Issue kommentieren, so dass die Funktionalität verbessert werden konnte, oder das Issue schließen.
%Durch die Einteilung in Issues wurde somit sichergestellt, dass sämtliche Funktionalitäten getestet und auch vollständig umgesetzt wurden, da zu einem Zeitpunkt sämtliche Issues, bezüglich des Abrechnungsmechanismus, als abgeschlossen eingestuft wurden.

%\begin{itemize}
%	\item Durch diese Realisierung ist es möglich das zu tun was in den Anforderungen beschrieben wurde
%	\item D.h. durch die Rationalisierung kann durchgeführt werden
%\end{itemize} 